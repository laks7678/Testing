import sys
import os
import logging
import configparser
from github import Github
import findspark
findspark.init()
findspark.find()
import pyspark
from pyspark import SparkContext, SparkConf, SQLContext
from pyspark.sql import SparkSession
import pyodbc
import pandas as pd
from pyspark.sql import functions as F
from pyspark.sql.functions import lit, col
from _io import StringIO

spark=SparkSession.builder.appName("Building Pyspark code with Synapse statements embedded").getOrCreate()
sc=spark.sparkContext


cp = configparser.ConfigParser()
g = Github(os.environ.get('GITHUB_TOKEN'))
repo = g.get_user().get_repo( 'Testing' )
files_and_dirs = [fd for fd in repo.get_dir_contents('/')]
fileDataList=[]
contents = repo.get_contents('resources')
while len(contents)>0:
    file_content = contents.pop(0)
    if file_content.type=='dir':
        contents.extend(repo.get_contents(file_content.path))
    else :
        if file_content.name=='properties_1.ini':
            cp.readfp(StringIO(file_content.decoded_content.decode()))


database =cp.get('SQLSERVERDBConnection', 'database')
user = cp.get('SQLSERVERDBConnection', 'user')
password = cp.get('SQLSERVERDBConnection', 'password')
driver = cp.get('SQLSERVERDBConnection', 'driver')
server = cp.get('SQLSERVERDBConnection', 'server')
connection = pyodbc.connect(f'DRIVER={driver};SERVER={server};DATABASE={database};UID={user};PWD={password}')


query5 = "SELECT GETQUERYBAND()"
cursor = connection.cursor()
cursor.execute(query5)
for row in cursor:
    print(row)

query7 = "DELETE FROM $DB_ETL_VIEWS_ESI.$PRCS1_NM"
cursor = connection.cursor()
cursor.execute(query7)
connection.commit()

query8 = "INSERT INTO $DB_ETL_VIEWS_ESI.$PRCS1_NM(SRC_SYSTM, WPEDW_RECORD_SEQ_NBR, WPEDW_RECORD_SEQ_DT_YYMMDD, WPEDW_SUB_NBR, WPEDW_SUB_NBR_20, WPEDW_PAT_SEX_CD, WPEDW_PAT_REL_CD, WPEDW_PAT_BCEN, WPEDW_PAT_BIRTH_DT, WPEDW_GROUP_NBR, WPEDW_SRC_SYS_ELIG, WPEDW_SERIAL_NBR, WPEDW_PHARM_ID, WPEDW_PHARM_STATE, WPEDW_PHARM_ZIP, WPEDW_DOC_NBR, WPEDW_RX_NBR, WPEDW_PAID_CENDT, WPEDW_FILL_CENDT, WPEDW_NDC_NBR11, WPEDW_DRUG_NM, WPEDW_THERAP_CLASS_CD, WPEDW_DEA_CD, WPEDW_BRAND_CD, WPEDW_DAW_CD, WPEDW_REFILL_CD, WPEDW_DISPNSE_QTY, WPEDW_DAYS_SUPPLY, WPEDW_DISPNSE_UNT, WPEDW_PHARM_BILL_AMT, WPEDW_PER_UNT_AWP, WPEDW_EXTENDED_AWP, WPEDW_INGRED_COST, WPEDW_DISPNSE_FEE, WPEDW_DEDUCT, WPEDW_COPAY, WPEDW_COINSUR, WPEDW_TAX_AMT, WPEDW_EXCLUS1_CD, WPEDW_EXCLUS1_AMT, WPEDW_EXCLUS2_CD, WPEDW_EXCLUS2_AMT, WPEDW_EXCLUS3_CD, WPEDW_EXCLUS3_AMT, WPEDW_EXCLUS4_CD, WPEDW_EXCLUS4_AMT, WPEDW_EXCLUS5_CD, WPEDW_EXCLUS5_AMT, WPEDW_EXCLUS6_CD, WPEDW_EXCLUS6_AMT, WPEDW_EXCLUS7_CD, WPEDW_EXCLUS7_AMT, WPEDW_EXCLUS8_CD, WPEDW_EXCLUS8_AMT, WPEDW_EXCLUS9_CD, WPEDW_EXCLUS9_AMT, WPEDW_EXCLUS10_CD, WPEDW_EXCLUS10_AMT, WPEDW_NET_CHECK, WPEDW_PROC_CENDT, WPEDW_GPI, WPEDW_GENERIC_AVAIL, WPEDW_DIFF, WPEDW_NUM_CLM, WPEDW_DEA_PRVDR_ID_QUAL, WPEDW_DEA_PRVDR_ID, WPEDW_CASE_NAME, WPEDW_MBS, WPEDW_REGION, WPEDW_PRODUCT, WPEDW_FUND_TYPE, WPEDW_PERIOD, WPEDW_STATE, WPEDW_ZIP9, WPEDW_CLIENT_CDE, WPEDW_LOB_CODE, WPEDW_NETWORK_CDE, WPEDW_FORM_IND, WPEDW_MAIL_ORDER_CDE, WPEDW_PAR_IND, WPEDW_MEM_LNAME, WPEDW_MEM_FNAME, WPEDW_PMG, WPEDW_RX_OTC_IND_CDE, WPEDW_REC_CTL_NO, WPEDW_PRSP_DTE, WPEDW_COB_CD, WPEDW_CMPND_PRSP_CD, WPEDW_PHAR_NETWK_CD, WPEDW_PAT_LAST_NM, WPEDW_PAT_FIRST_NM, WPEDW_PAT_MID_INIT, WPEDW_PAYEE_LAST_NM, WPEDW_PAYEE_FIRST_NM, WPEDW_PAYEE_MID_INIT, WPEDW_PAYE_LINE_1_STR, WPEDW_PAYE_LINE_2_STR, WPEDW_PAYE_CITY, WPEDW_PAYE_ST, WPEDW_PAYEE_ZIP_CD, WPEDW_PAY_CHK_NO, WPEDW_GRP_DRUG_EFF_DTE, WPEDW_LOB_GRP_INFO, WPEDW_MAIL_ORD_COPAY_TYP_CD, WPEDW_BRAND_COPAY_AMT, WPEDW_COPAY_TYP_CD, WPEDW_CTL_GRP_NO, WPEDW_SUBR_STR, WPEDW_SUBR_CITY, WPEDW_SUBR_STATE, WPEDW_SUBR_ZIP_15, WPEDW_DEP_BRTH_DTE, WPEDW_OTHER_CARRIER_PAY_AMT, WPEDW_MBR_BEN_LMT_AMT, WPEDW_CLM_BEN_AMT, WPEDW_CLM_RECEIVE_DTE, WPEDW_DRUG_UTL_REVW_TYP_CD, WPEDW_PRSP_DRUG_LABEL_NM, WPEDW_AHFS_DRUG_THERAP_CD, WPEDW_MAC_SCHD_IND, WPEDW_DRUG_AWP_AMT, WPEDW_MBR_SEX_CD, WPEDW_DRUG_PRIOR_APPV_RSN_CD_1, WPEDW_DRUG_PRIOR_APPV_RSN_CD_2, WPEDW_DRUG_PRIOR_APPV_RSN_CD_3, WPEDW_DRUG_PRIOR_APPV_RSN_CD_4, WPEDW_NETWK_CHOSEN_CD, WPEDW_DRUG_PRIOR_APPV_CMT_CD, WPEDW_DRUG_PRIOR_APPV_CD, WPEDW_CHN_PHAR_NO, WPEDW_DRUG_CLM_SOURCE_CD, WPEDW_PROCESR_BATCH_NO_DTE, WPEDW_BATCH_SEQ_NBR, WPEDW_CLAIM_FORM_CD, WPEDW_CLAIM_DISP_CD, WPEDW_ORIG_SUBMIT_GRP_NO, WPEDW_ORIG_HOME_PLAN_CD, WPEDW_SUB_CLAIM_PHARM_NBR, WPEDW_DRUG_ORIG_AMT, WPEDW_DRUG_UNIT_CST_AMT, WPEDW_HOME_PLAN_CD, WPEDW_GEN_DRUG_CD_NO, WPEDW_GEN_DRUG_PRODUCT_CD, WPEDW_PD_CLM_WARN_CD, WPEDW_DRUG_CLM_REJ_OVER_CD, WPEDW_CLM_FORCE_REJ_3_CD, WPEDW_ORIG_CLM_PAY_DTE, WPEDW_SMART_KEY_FIELDS, WPEDW_PHARM_TYPE_CD, WPEDW_PAT_REL_CD2, WPEDW_EXP_GROUP_NBR, WPEDW_EXP_GROUP_SECT_NBR, WPEDW_CASE_NO, WPEDW_CLIENT_RPT5, WPEDW_CLIENT_RPT6, WPEDW_HEALTH_CARD_ID, WPEDW_MBS1, WPEDW_COMPANY_CODE, WPEDW_MEDICARE_ADMIN_FEE, WPEDW_PHAR_CLM_BAL_AMT, WPEDW_CLIENT_NETWK_CD, WPEDW_OTHER_TROOP_AMT, WPEDW_TOTAL_PLRO_AMT, WPEDW_LICS_SUBSIDY_AMT, WPEDW_LICS_IND, WPEDW_GROUP_PRODUCT_IND, WPEDW_CONTRACT_NO, WPEDW_HICN, WPEDW_PBP_ID, WPEDW_CATASTROPHIC_COV_CD, WPEDW_CLM_TROOP_AMT, WPEDW_DRUG_COV_STAT_CD, WPEDW_CLM_TOTAL_AMT, WPEDW_CLM_CATASTROPHIC_AMT, WPEDW_OTHER_CARRIER_PTD_AMT, WPEDW_NETWK_DIFF_PTD_AMT, WPEDW_PAT_PAY_AMT_EDT, WPEDW_GDCA_AMT_EDT, WPEDW_PRIC_EXP_CD, WPEDW_ORIG_PRSP_NO_QUAL, WPEDW_ORIG_PRSP_NO_9, WPEDW_COB_OTH_PAYER_COV_TYPE, WPEDW_PHAR_MKUP_AMT, WPEDW_PRSP_CARD_GRP_NO_COMB, WPEDW_REASON_CD, WPEDW_SUBR_SALES_TAX_AMT, WPEDW_FLAT_SALES_TAX_SUBMIT, WPEDW_SALES_TAX_RATE, WPEDW_SALES_TAX_BASIS, WPEDW_GRP_DRUG_SUSP_DTE_8, WPEDW_EXPD_DRUG_RIDER_CD, WPEDW_PRSP_REFILL_VAL, WPEDW_DRUG_RSTRC_CD, WPEDW_SBMT_DRUG_INGRED_CST_A, WPEDW_USUAL_AND_CUST_DRUG_A, WPEDW_SUBRPSALE_CLM_MATCHIND, WPEDW_PRSP_CARD_CREATE_DTE_8, WPEDW_PRSP_CARD_EXPIR_DTE_8, WPEDW_SUBR_SPEC_DRUG_COV_IND, WPEDW_SUBR_CONT_EXT_NO, WPEDW_SUBR_SEX_CD, WPEDW_DEP_LAST_NM, WPEDW_DEP_FIRST_NM_EXP, WPEDW_DRUG_GENERIC_NM, WPEDW_DRUG_FORM_TEXT, WPEDW_DRUG_MANUF_DSTRBUTR_NM, WPEDW_DRUG_STD_PKG_SZ_IND, WPEDW_DRUG_UNIT_DOSE_PKG_IND, WPEDW_DRUG_FORM_CD, WPEDW_DRUG_PKG_SZ_QTY, WPEDW_DESI_DRUG_IND, WPEDW_PRIM_CARRIER_CD, WPEDW_DRUG_PRODUCT_OBS_DTE_8, WPEDW_MED_COND_TEXT, WPEDW_TRML_OPER_NO, WPEDW_NEW_ACCUM_LOGIC_FL, WPEDW_BRAND_DISCOUNT_PERCENT, WPEDW_GNRC_DISCOUNT_PERCENT, WPEDW_PHAR_PRIOR_APPV_OVR_CD, WPEDW_PHYS_OUT_NETWORK, WPEDW_HOLD_FROM_PAY_CD, WPEDW_DRUG_CLM_TRANS_CD, WPEDW_PHAR_DISPEN_NM, WPEDW_PHAR_DISPEN_STR, WPEDW_PHAR_DISPEN_CITY, WPEDW_PHAR_DISPEN_STATE, WPEDW_PHAR_DISPEN_ZIP_CD_15, WPEDW_PHAR_EFF_DTE_8, WPEDW_PHAR_DEL_DTE_8, WPEDW_CENT_CLM_PROCESS_SITCD, WPEDW_PHAR_PROFES_FEE_IND, WPEDW_PHAR_FORM_REMB_IND, WPEDW_PHAR_SPEC_DISPEN_FEE_A, WPEDW_DEP_COPAY_PERCENT, WPEDW_REJ_OVER_RMVL_CD, WPEDW_ORIG_CHK_NO, WPEDW_DED_PROCESS_SORT_SEQNO, WPEDW_CHN_PHAR_PAYEE_ID_NO, WPEDW_CLM_SUBMIT_CD, WPEDW_DRUG_REC_CORR_IND, WPEDW_DRUG_CLM_PRESORTMAILCD, WPEDW_CLM_SORT_SEQ_NO, WPEDW_CLM_REV_DTE_8, WPEDW_MBR_MED_DED_AMT, WPEDW_PAY_BRAND_PRICE_IND, WPEDW_PLAN_ASGN_PHYS_ID_QUAL, WPEDW_PLAN_ASGN_PHYS_ID_NO, WPEDW_REJ_CLAIMS_ALLOWED_AMT, WPEDW_ORNG_BK_THERAP_CD, WPEDW_ADDL_DCN_OR_MAC_AMT, WPEDW_MBR_MED_BEN_LMT_AMT, WPEDW_LEASE_LINE_CHARGE_IND, WPEDW_FDB_GNRC_DRUGPRODUCTCD, WPEDW_GENERIC_MANUFACTURERCD, WPEDW_GENERIC_NAME_CD, WPEDW_GENERIC_SPREAD_CD, WPEDW_BATCH_SEQ_ONCORRECTION, WPEDW_IL_FORMULARY_DRUG_CD, WPEDW_BRAND_CMPND_DISP_FEE_A, WPEDW_GNRC_CMPND_DISP_FEE_A, WPEDW_PHYS_LAST_NM, WPEDW_PHYS_FIRST_NM, WPEDW_PA_TYPE_CD, WPEDW_PA_BEGIN_DT, WPEDW_PA_END_DT, WPEDW_PA_INCLUD_EXCLUD_CD, WPEDW_PA_TYPE_FIELD, WPEDW_PA_SCRIPTS_USED, WPEDW_PA_DAYS_USED, WPEDW_PA_UNITS_USED, WPEDW_PA_DOLLARS_USED, WPEDW_PA_USE_CAP, WPEDW_PA_USE_DED, WPEDW_PA_USE_OOP, WPEDW_PA_COPAY_TYPE, WPEDW_PA_COPAY_AMT, WPEDW_NATL_NETWRK_EXCEPT_CD, WPEDW_LOCAL_EXCEPT_CD, WPEDW_BASIS_OF_COST_CD, WPEDW_AWP_PHAR_AUD_PERCENT_OLD, WPEDW_CHN_PHAR_DISPEN_FEE_A, WPEDW_CHN_GNRC_DISPEN_FEE_A, WPEDW_COPAYTBL_NETWK_TYP, WPEDW_COPAYTBL_COPAY_GRP, WPEDW_COPAYTBL_COPAY_CAT, WPEDW_COPAYTBL_MIN_COPAY, WPEDW_COPAYTBL_MAX_COPAY, WPEDW_COPAYTBL_EXEMPT_LIST, WPEDW_COPAYTBL_DAW_EXEMPT, WPEDW_COPAYTBL_REGR_PCT_IND, WPEDW_COPAYTBL_REGR_PCT, WPEDW_COPAYTBL_PAY_DIFF_IND, WPEDW_WORK_COMP_ICD9_3, WPEDW_WORK_COMP_ICD9_PD, WPEDW_WORK_COMP_ICD9_2, WPEDW_ZERO_BALANCE_COPAY, WPEDW_MAC_ONLY_GEN_DISP_FEE, WPEDW_MAC_ADDL_PERCENT_AMT, WPEDW_MAC_ADDL_PERCENT_PRC, WPEDW_ANY_WILLING_PROV, WPEDW_CONT_SATISFY_BEN_LMT_A, WPEDW_PRIM_REJ_CD_1, WPEDW_PRIM_REJ_CD_2, WPEDW_PRIM_REJ_CD_3, WPEDW_CLIENT_FORM_FORMCD, WPEDW_DRUG_STRENGTH_TEXT, WPEDW_DRUG_CAT_CD, WPEDW_CLIENT_FORM_CODE1, WPEDW_MBS_CD, WPEDW_CONT_COV_CD, WPEDW_PRODUCT_ID_CD, WPEDW_DEP_BRTH_CC, WPEDW_GNRC_BR_VAR_COPAY_AMT, WPEDW_DRUG_SOURCE_CD, WPEDW_PAT_PAY_AMT, WPEDW_CPP_AMT, WPEDW_NPP_AMT, WPEDW_GDCB_AMT, WPEDW_GDCA_AMT, WPEDW_OON_CD, WPEDT_SPEND_ACCT_APPL_AMT, WPEDT_THC_AMT, WPEDT_HRA_FUND_TYPE, WPEDT_PHARM_NPI_ID, WPEDT_PHYS_NPI_ID, WPEDT_MEM_SEQ_NBR, WPEDT_DED_BEFORE_HRA, WPEDW_EXT_PRODUCT, WPEDW_MEMBER_MISC, WPEDW_GROUP_MISC, LOAD_LOG_KEY, GL_BUSINESS_UNIT, GL_MBU, GL_FUNDING_CODE_THC, GL_FUNDING_CODE_CDH, GL_PRODUCT, GL_LOCATION, GL_DETAIL_PRODUCT, GL_AMOUNT, GL_HRA_AMOUNT, GL_STATISTICAL_AMOUNT, GL_ACCOUNT_NUMBER, GL_AFFILIATE, GL_POST_DT, ESI_DIV_CD, ESI_PLAN_TYPE, GL_ACCNT_NBR_CDH, WPEDW_DLY_WKLY_IND, WPEDW_AMT_EXCD_PER_BEN_MAX, WPEDW_VEND_AUTO_PAY_IND,GL_ACCNT_NBR_ADM, WPEDW_EXTNDD_RX_NUM, WPEDW_PRTL_FILL_STTS_CD, WPEDW_DRUG_PKG_SZ_QTY_EXT, WPEDW_INGRED_COST_MRGN, WPEDW_DSPNSG_FEE_MRGN, WPEDW_ADMIN_FEE_MRGN, WPEDW_AMT_BILLD_MRGN, WLP_PHYS_IO_NTW_IND) SELECT CASE WHEN TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4)) = 'WGS' THEN 'WGS' WHEN SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4) = 'STAR' THEN 'STAR' WHEN SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4) = 'QCAR' THEN 'QCAR' WHEN TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4)) = 'WGS' THEN 'WGS' WHEN SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4) = 'STAR' THEN 'STAR' WHEN SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4) = 'QCAR' THEN 'QCAR' ELSE RIGHT(' ',4,' ') END AS "1", NULL AS "C CASE WHEN LZ_ESI_CLM_MSTR.ADJDCTN_DT = '8888 WHEN LZ_ESI_CLM_MSTR.ADJDCTN_DT IS NULL THEN '9999 ELSE LZ_ESI_CLM_MSTR.ADJDCTN_DT END AS "C SUBSTRING(LZ_ESI_CLM_MSTR.CARDHOLDER_ID_NBR,1,15) AS "C LZ_ESI_CLM_MSTR.CARDHOLDER_ID_NBR AS "C CASE WHEN LZ_ESI_CLM_MSTR.SEX_CD = 1 THEN 'M' WHEN LZ_ESI_CLM_MSTR.SEX_CD = 2 THEN 'F' ELSE ' ' END AS "C CASE WHEN ( TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4)) = 'STAR' OR TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4)) = 'STAR' ) THEN SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,57,2) ELSE TRIM(LZ_ESI_CLM_MSTR.WLP_MBR_CD) END AS "C CAST( SUBSTRING( CAST( CAST( LZ_ESI_CLM_MSTR.BRTH_DT AS DATE FORMAT 'YYYY') AS CHAR(4) ) , 1, 2) AS DECIMAL(2)) AS "C CASE WHEN LZ_ESI_CLM_MSTR.BRTH_DT = '8888 WHEN LZ_ESI_CLM_MSTR.BRTH_DT IS NULL THEN '9999 ELSE LZ_ESI_CLM_MSTR.BRTH_DT END AS "C CASE WHEN ( TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4)) = 'WGS' OR TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4)) = 'WGS' ) THEN SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,1,15) WHEN ( SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4) = 'QCAR' OR SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4) = 'QCAR' ) THEN CASE WHEN SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,1,2) IN ('32', '33', '34', '35') THEN ( SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,163,7) + SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,1,2) + SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,1,3) ) ELSE NULL END WHEN ( SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4) = 'STAR' OR SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4) = 'STAR' ) THEN CASE WHEN SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,1,3) IN ('IND', 'SNR', 'STE') THEN TRIM ( TRAILING FROM ( SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,1,6) + '0000' ) ) ELSE TRIM ( TRAILING FROM ( SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,30,6) + '0000' ) ) END END AS "C CASE WHEN TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4)) = 'WGS' THEN 'WGS' WHEN SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4) = 'STAR' THEN 'STA' WHEN SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4) = 'QCAR' THEN 'QCA' WHEN TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4)) = 'WGS' THEN 'WGS' WHEN SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4) = 'STAR' THEN 'STA' WHEN SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4) = 'QCAR' THEN 'QCA' ELSE RIGHT(' ',3,' ') END AS "C LZ_ESI_CLM_MSTR.CLNT_BPL_ID AS "C LZ_ESI_CLM_MSTR.PHRMCY_NBR AS "C CASE WHEN TRIM(PHRMCY_INFO.PHRMCY_LCTN_ST_CD) IN ('UNK' ,'NA', '') THEN NULL ELSE TRIM(PHRMCY_INFO.PHRMCY_LCTN_ST_CD) END AS "C PHRMCY_INFO.ZIP_CD AS "C LZ_ESI_CLM_MSTR.ESI_ADJDCTN_RFRNC_NBR AS "C LZ_ESI_CLM_MSTR.RX_NBR AS "C CASE WHEN LZ_ESI_CLM_MSTR.CHCK_DT = '8888 WHEN LZ_ESI_CLM_MSTR.CHCK_DT IS NULL THEN '9999 ELSE LZ_ESI_CLM_MSTR.CHCK_DT END AS "C CASE WHEN LZ_ESI_CLM_MSTR.FILLED_DT = '8888 WHEN LZ_ESI_CLM_MSTR.FILLED_DT IS NULL THEN '9999 ELSE LZ_ESI_CLM_MSTR.FILLED_DT END AS "C LZ_ESI_CLM_MSTR.NDC_NBR AS "C CASE WHEN TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.LBL_NM,1,25)) NOT IN ('UNK' ,'NA', '') THEN TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.LBL_NM,1,25)) ELSE CASE WHEN TRIM(SUBSTRING(NBC_INFO.LABEL_NM,1,25)) NOT IN ('UNK' ,'NA', '') THEN TRIM(SUBSTRING(NBC_INFO.LABEL_NM,1,25)) ELSE RX_INFO.LABEL_NM END END AS "C CASE WHEN TRIM(SUBSTRING(NBC_INFO.THRPTC_AHFS_CLASS_CD,1,6)) IN ('UNK' ,'NA', '') THEN CASE WHEN TRIM(SUBSTRING(RX_INFO.THRPTC_AHFS_CLASS_CD,1,6)) IN ('UNK' ,'NA', '') THEN 0 ELSE CASE WHEN ( CHARINDEX(' ' , TRIM(SUBSTRING(RX_INFO.THRPTC_AHFS_CLASS_CD,1,6))) > 0) OR (UPPER(TRIM(SUBSTRING(RX_INFO.THRPTC_AHFS_CLASS_CD,1,6))) (CASESPECIFIC) <> LOWER(TRIM(SUBSTRING(RX_INFO.THRPTC_AHFS_CLASS_CD,1,6))) (CASESPECIFIC)) THEN 0 ELSE CAST (TRIM(SUBSTRING(RX_INFO.THRPTC_AHFS_CLASS_CD,1,6)) AS DECIMAL (6,0)) END END ELSE CASE WHEN ( CHARINDEX(' ' , TRIM(SUBSTRING(NBC_INFO.THRPTC_AHFS_CLASS_CD,1,6))) > 0) OR (UPPER(TRIM(SUBSTRING(NBC_INFO.THRPTC_AHFS_CLASS_CD,1,6))) (CASESPECIFIC) <> LOWER(TRIM(SUBSTRING(NBC_INFO.THRPTC_AHFS_CLASS_CD,1,6))) (CASESPECIFIC)) THEN 0 ELSE CAST (TRIM(SUBSTRING(NBC_INFO.THRPTC_AHFS_CLASS_CD,1,6)) AS DECIMAL (6,0)) END END AS "C CAST (CAST (LZ_ESI_CLM_MSTR.DEA_SCHDL_CD AS DECIMAL (1,0)) AS CHAR(1)) AS "C CASE WHEN TRIM(LZ_ESI_CLM_MSTR.DRUG_TYPE_CD) = '0' THEN ' ' WHEN TRIM(LZ_ESI_CLM_MSTR.DRUG_TYPE_CD) = '1' THEN 'B' WHEN TRIM(LZ_ESI_CLM_MSTR.DRUG_TYPE_CD) = '2' THEN 'B' WHEN TRIM(LZ_ESI_CLM_MSTR.DRUG_TYPE_CD) = '3' THEN 'G' WHEN TRIM(LZ_ESI_CLM_MSTR.DRUG_TYPE_CD) = '4' THEN ' ' WHEN TRIM(LZ_ESI_CLM_MSTR.DRUG_TYPE_CD) = '5' THEN 'B' ELSE NULL END AS "C CASE WHEN TRIM(LZ_ESI_CLM_MSTR.DAW_PROD_SLCTN_CD) IN ('UNK' ,'NA', '') THEN 0 WHEN ( CHARINDEX(' ' , TRIM(LZ_ESI_CLM_MSTR.DAW_PROD_SLCTN_CD)) > 0) OR (UPPER(TRIM(LZ_ESI_CLM_MSTR.DAW_PROD_SLCTN_CD)) (CASESPECIFIC) <> LOWER(TRIM(LZ_ESI_CLM_MSTR.DAW_PROD_SLCTN_CD)) (CASESPECIFIC)) THEN 0 WHEN LZ_ESI_CLM_MSTR.DAW_PROD_SLCTN_CD IS NULL THEN 0 ELSE CAST (TRIM(LZ_ESI_CLM_MSTR.DAW_PROD_SLCTN_CD) AS DECIMAL (1,0)) END AS "C CASE WHEN TRIM(LZ_ESI_CLM_MSTR.NEW_REFILL_CD) IN ('UNK' ,'NA', '') THEN NULL WHEN TRIM(LZ_ESI_CLM_MSTR.NEW_REFILL_CD) = '00' THEN 'N' ELSE 'Y' END AS "C CASE WHEN TRIM( UPPER (LZ_ESI_CLM_MSTR.CLM_TYPE_CD)) = 'R' THEN ( ELSE LZ_ESI_CLM_MSTR.MTRC_QTY_NBR END AS "C CASE WHEN TRIM( UPPER (LZ_ESI_CLM_MSTR.CLM_TYPE_CD)) = 'R' THEN ( ELSE LZ_ESI_CLM_MSTR.DAYS_SPLY_NBR END AS "C CASE WHEN TRIM(NBC_INFO.PKG_UOM_CD) IN ('UNK' ,'NA', '') THEN CASE WHEN TRIM(RX_INFO.PKG_UOM_CD) IN ('UNK' ,'NA', '') THEN NULL ELSE RX_INFO.PKG_UOM_CD END ELSE NBC_INFO.PKG_UOM_CD END AS "C CASE WHEN TRIM( UPPER (LZ_ESI_CLM_MSTR.CLM_TYPE_CD)) = 'R' THEN ( ELSE LZ_ESI_CLM_MSTR.CSTMRY_CHRG_AMT + LZ_ESI_CLM_MSTR.WLP_DSPNSG_FEE + LZ_ESI_CLM_MSTR.WLP_SALES_TAX END AS "C CASE WHEN PRCNG_INFO_AWP.PRICE_AMT IS NULL THEN 0 ELSE CASE WHEN PRCNG_INFO_AWP.PRICE_AMT <= 9999.9999 THEN PRCNG_INFO_AWP.PRICE_AMT ELSE CASE WHEN PRCNG_INFO_AWP.PRICE_AMT > 9999.9999 THEN 9999.9999 ELSE 0 END END END AS "C CASE WHEN TRIM( UPPER (LZ_ESI_CLM_MSTR.CLM_TYPE_CD)) = 'R' THEN ( ELSE LZ_ESI_CLM_MSTR.FULL_AWP_AMT END AS "C LZ_ESI_CLM_MSTR.WLP_INGRED_COST + LZ_ESI_CLM_MSTR.OTHR_PAYOR_AMT AS "C LZ_ESI_CLM_MSTR.WLP_DSPNSG_FEE AS "C LZ_ESI_CLM_MSTR.DDCTBL_AMT AS "C CASE WHEN TRIM( UPPER (LZ_ESI_CLM_MSTR.CLM_TYPE_CD)) = 'R' THEN ( LZ_ESI_CLM_MSTR.CPAY_AMT (LZ_ESI_CLM_MSTR.DDCTBL_AMT (LZ_ESI_CLM_MSTR.MBR_AMT_COINSRN ) ELSE ( LZ_ESI_CLM_MSTR.CPAY_AMT (LZ_ESI_CLM_MSTR.DDCTBL_AMT (LZ_ESI_CLM_MSTR.MBR_AMT_COINSRN ) END AS "C CASE WHEN TRIM( UPPER (LZ_ESI_CLM_MSTR.CLM_TYPE_CD)) = 'R' THEN (LZ_ESI_CLM_MSTR.MBR_AMT_COINSRN ELSE (LZ_ESI_CLM_MSTR.MBR_AMT_COINSRN END AS "C LZ_ESI_CLM_MSTR.WLP_SALES_TAX AS "C CASE WHEN TRIM( UPPER (LZ_ESI_CLM_MSTR.CLM_TYPE_CD)) = 'D' THEN LZ_ESI_CLM_MSTR.ADJST_RJCT_CD ELSE NULL END AS "C CASE WHEN TRIM( UPPER (LZ_ESI_CLM_MSTR.CLM_TYPE_CD)) = 'D' THEN CASE WHEN TRIM( LZ_ESI_CLM_MSTR.ADJST_RJCT_CD) = '' THEN 0 WHEN LZ_ESI_CLM_MSTR.ADJST_RJCT_CD IS NULL THEN 0 ELSE LZ_ESI_CLM_MSTR.CSTMRY_CHRG_AMT END ELSE 0 END AS "C CASE WHEN TRIM( UPPER (LZ_ESI_CLM_MSTR.CLM_TYPE_CD)) = 'D' THEN LZ_ESI_CLM_MSTR.ADJST_RJCT_CD_2 ELSE NULL END AS "C NULL AS "C CASE WHEN TRIM( UPPER (LZ_ESI_CLM_MSTR.CLM_TYPE_CD)) = 'D' THEN LZ_ESI_CLM_MSTR.ADJST_RJCT_CD_3 ELSE NULL END AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C LZ_ESI_CLM_MSTR.WLP_AMT_BILLD CASE WHEN LZ_ESI_CLM_MSTR.ADJDCTN_DT = '8888 WHEN LZ_ESI_CLM_MSTR.ADJDCTN_DT IS NULL THEN '9999 ELSE LZ_ESI_CLM_MSTR.ADJDCTN_DT END AS "C CASE WHEN TRIM(LZ_ESI_CLM_MSTR.GPI) IN ('UNK' ,'NA', '') THEN CASE WHEN TRIM(RX_INFO.GPI) IN ('UNK' ,'NA', '') THEN NULL ELSE RX_INFO.GPI END ELSE LZ_ESI_CLM_MSTR.GPI END AS "C CASE WHEN ((TRIM(LZ_ESI_CLM_MSTR.DRUG_TYPE_CD) = '3' AND NBC_INFO.GNRC_IND_CD = '1') OR LZ_ESI_CLM_MSTR.FED_DRUG_CLS_CD = 'O') THEN 'Y' ELSE CASE WHEN ((TRIM(LZ_ESI_CLM_MSTR.DRUG_TYPE_CD) = '3' AND RX_INFO.GNRC_MULTI_SRC_CD = '1') OR LZ_ESI_CLM_MSTR.FED_DRUG_CLS_CD = 'O') THEN 'Y' ELSE 'N' END END AS "C CASE WHEN TRIM(LZ_ESI_CLM_MSTR.ADJST_RJCT_CD) IN ('UNK' ,'NA', '') OR LZ_ESI_CLM_MSTR.ADJST_RJCT_CD IS NULL THEN CASE WHEN TRIM( UPPER (LZ_ESI_CLM_MSTR.CLM_TYPE_CD)) = 'R' THEN ( ELSE LZ_ESI_CLM_MSTR.CSTMRY_CHRG_AMT + LZ_ESI_CLM_MSTR.WLP_DSPNSG_FEE END ELSE CASE WHEN TRIM( UPPER (LZ_ESI_CLM_MSTR.CLM_TYPE_CD)) = 'R' THEN ( ELSE LZ_ESI_CLM_MSTR.CSTMRY_CHRG_AMT + LZ_ESI_CLM_MSTR.WLP_DSPNSG_FEE END END AS "C CASE WHEN UPPER(TRIM(LZ_ESI_CLM_MSTR.CLM_TYPE_CD)) = 'P' THEN 1 WHEN UPPER(TRIM(LZ_ESI_CLM_MSTR.CLM_TYPE_CD)) = 'R' THEN ELSE 0 END AS "C CASE WHEN TRIM(LZ_ESI_CLM_MSTR.PRSCRBR_QLFR_CD) IN ('UNK' ,'NA', '') THEN NULL ELSE TRIM(LZ_ESI_CLM_MSTR.PRSCRBR_QLFR_CD) END AS "C CASE WHEN TRIM(LZ_ESI_CLM_MSTR.PRSCRBR_ID) IN ('UNK' ,'NA', '') THEN NULL ELSE TRIM(LZ_ESI_CLM_MSTR.PRSCRBR_ID) END AS "C SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,75,30) AS "C CASE WHEN ( TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4)) = 'WGS' OR TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4)) = 'WGS' ) THEN SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,140,8) WHEN ( SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4) = 'QCAR' OR SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4) = 'QCAR' OR SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4) = 'STAR' OR SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4) = 'STAR' ) THEN SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,154,8) END AS "C NULL AS "C CASE WHEN TRIM(LZ_ESI_CLM_MSTR.CLNT_CUST_ID) IN ('UNK' ,'NA', '') THEN NULL WHEN ( UPPER(TRIM(LZ_ESI_CLM_MSTR.CLNT_CUST_ID)) IN ('HOUSE ACCOUNT','NATL ACCTS') AND UPPER(TRIM(LZ_ESI_CLM_MSTR.SUB_CARR_CD)) = 'WLH' ) THEN '36' ELSE SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,1,2) END AS "C CASE WHEN ( TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4)) = 'WGS' OR TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4)) = 'WGS' ) THEN SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,144,1) WHEN ( SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4) = 'QCAR' OR SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4) = 'QCAR' OR SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4) = 'STAR' OR SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4) = 'STAR' ) THEN SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,158,1) END AS "C CASE WHEN LZ_ESI_CLM_MSTR.CHCK_DT = '8888 WHEN LZ_ESI_CLM_MSTR.CHCK_DT IS NULL THEN '9999 ELSE LZ_ESI_CLM_MSTR.CHCK_DT END AS "C CASE WHEN TRIM(LZ_ESI_CLM_MSTR.PRSCRBR_ADRS_ST) IN ('UNK' ,'NA', '') THEN NULL ELSE TRIM(LZ_ESI_CLM_MSTR.PRSCRBR_ADRS_ST) END AS "C LZ_ESI_CLM_MSTR.PRSCRBR_ADRS_ZIP AS "C CASE WHEN ( CASE WHEN UPPER(TRIM(LZ_ESI_CLM_MSTR.CLNT_CUST_ID)) IN ('HOUSE ACCOUNT','NATL ACCTS') THEN '36' WHEN TRIM(LZ_ESI_CLM_MSTR.CLNT_CUST_ID) IN ('UNK' ,'NA', '') THEN NULL ELSE SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,1,2) END ) IN ('36', '41', '42', '43', '61', '62', '63', '64') THEN 'BCC' WHEN ( CASE WHEN UPPER(TRIM(LZ_ESI_CLM_MSTR.CLNT_CUST_ID)) IN ('HOUSE ACCOUNT','NATL ACCTS') THEN '36' WHEN TRIM(LZ_ESI_CLM_MSTR.CLNT_CUST_ID) IN ('UNK' ,'NA', '') THEN NULL ELSE SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,1,2) END ) IN ('28', '32', '33', '34', '35') THEN 'BGA' WHEN ( CASE WHEN UPPER(TRIM(LZ_ESI_CLM_MSTR.CLNT_CUST_ID)) IN ('HOUSE ACCOUNT','NATL ACCTS') THEN '36' WHEN TRIM(LZ_ESI_CLM_MSTR.CLNT_CUST_ID) IN ('UNK' ,'NA', '') THEN NULL ELSE SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,1,2) END ) IN ('08', '67', '69', '83', '87', '88') THEN 'TPA' WHEN ( CASE WHEN UPPER(TRIM(LZ_ESI_CLM_MSTR.CLNT_CUST_ID)) IN ('HOUSE ACCOUNT','NATL ACCTS') THEN '36' WHEN TRIM(LZ_ESI_CLM_MSTR.CLNT_CUST_ID) IN ('UNK' ,'NA', '') THEN NULL ELSE SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,1,2) END ) = '51' THEN 'CNJ' WHEN ( CASE WHEN UPPER(TRIM(LZ_ESI_CLM_MSTR.CLNT_CUST_ID)) IN ('HOUSE ACCOUNT','NATL ACCTS') THEN '36' WHEN TRIM(LZ_ESI_CLM_MSTR.CLNT_CUST_ID) IN ('UNK' ,'NA', '') THEN NULL ELSE SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,1,2) END ) = '50' THEN 'BID' WHEN ( CASE WHEN UPPER(TRIM(LZ_ESI_CLM_MSTR.CLNT_CUST_ID)) IN ('HOUSE ACCOUNT','NATL ACCTS') THEN '36' WHEN TRIM(LZ_ESI_CLM_MSTR.CLNT_CUST_ID) IN ('UNK' ,'NA', '') THEN NULL ELSE SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,1,2) END ) IN ('58', '59', '68', '79') THEN 'TMK' WHEN ( CASE WHEN UPPER(TRIM(LZ_ESI_CLM_MSTR.CLNT_CUST_ID)) IN ('HOUSE ACCOUNT','NATL ACCTS') THEN '36' WHEN TRIM(LZ_ESI_CLM_MSTR.CLNT_CUST_ID) IN ('UNK' ,'NA', '') THEN NULL ELSE SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,1,2) END ) IN ('27', '29') THEN 'BRI' WHEN ( CASE WHEN UPPER(TRIM(LZ_ESI_CLM_MSTR.CLNT_CUST_ID)) IN ('HOUSE ACCOUNT','NATL ACCTS') THEN '36' WHEN TRIM(LZ_ESI_CLM_MSTR.CLNT_CUST_ID) IN ('UNK' ,'NA', '') THEN NULL ELSE SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,1,2) END ) = '19' THEN 'KSM' WHEN ( CASE WHEN UPPER(TRIM(LZ_ESI_CLM_MSTR.CLNT_CUST_ID)) IN ('HOUSE ACCOUNT','NATL ACCTS') THEN '36' WHEN TRIM(LZ_ESI_CLM_MSTR.CLNT_CUST_ID) IN ('UNK' ,'NA', '') THEN NULL ELSE SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,1,2) END ) = '18' THEN 'INM' WHEN ( CASE WHEN UPPER(TRIM(LZ_ESI_CLM_MSTR.CLNT_CUST_ID)) IN ('HOUSE ACCOUNT','NATL ACCTS') THEN '36' WHEN TRIM(LZ_ESI_CLM_MSTR.CLNT_CUST_ID) IN ('UNK' ,'NA', '') THEN NULL ELSE SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,1,2) END ) = '66' THEN 'HLK' WHEN ( CASE WHEN UPPER(TRIM(LZ_ESI_CLM_MSTR.CLNT_CUST_ID)) IN ('HOUSE ACCOUNT','NATL ACCTS') THEN '36' WHEN TRIM(LZ_ESI_CLM_MSTR.CLNT_CUST_ID) IN ('UNK' ,'NA', '') THEN NULL ELSE SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,1,2) END ) = '95' THEN 'BWI' WHEN ( LZ_ESI_CLM_MSTR.SUB_CARR_CD = 'WLE' AND UPPER(SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,1,4)) = 'CDHP' ) THEN 'CCO' WHEN ( LZ_ESI_CLM_MSTR.SUB_CARR_CD = 'WLE' AND UPPER(SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,1,4)) <> 'CDHP' ) THEN 'COL' WHEN ( LZ_ESI_CLM_MSTR.SUB_CARR_CD = 'WLF' AND UPPER(SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,1,4)) = 'CDHP' ) THEN 'CNV' WHEN ( LZ_ESI_CLM_MSTR.SUB_CARR_CD = 'WLF' AND UPPER(SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,1,4)) <> 'CDHP' ) THEN 'NEV' WHEN ( LZ_ESI_CLM_MSTR.SUB_CARR_CD = 'WLJ' AND UPPER(SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,1,4)) = 'CDHP' ) THEN 'CUN' WHEN ( LZ_ESI_CLM_MSTR.SUB_CARR_CD = 'WLJ' AND UPPER(TRIM(LZ_ESI_CLM_MSTR.CLNT_CUST_ID)) = 'UN SENIOR' ) THEN 'WIS' WHEN ( LZ_ESI_CLM_MSTR.SUB_CARR_CD = 'WL2' AND UPPER(TRIM(LZ_ESI_CLM_MSTR.CLNT_CUST_ID)) = 'HOUSE ACCOUNT' ) THEN 'HOU' WHEN ( LZ_ESI_CLM_MSTR.SUB_CARR_CD = 'WL6' AND UPPER(SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,1,4)) = 'CDHP' ) THEN 'CWI' WHEN ( LZ_ESI_CLM_MSTR.SUB_CARR_CD = 'WL6' AND UPPER(SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,1,4)) <> 'CDHP' ) THEN 'WIS' WHEN ( LZ_ESI_CLM_MSTR.SUB_CARR_CD = 'WLH' AND UPPER(SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,1,4)) = 'CDHP' ) THEN 'CCA' WHEN ( LZ_ESI_CLM_MSTR.SUB_CARR_CD = 'WLH' AND UPPER(TRIM(LZ_ESI_CLM_MSTR.CLNT_CUST_ID)) = 'NATL ACCTS' ) THEN 'NCA' WHEN ( LZ_ESI_CLM_MSTR.SUB_CARR_CD = 'WLH' AND UPPER(TRIM(LZ_ESI_CLM_MSTR.CLNT_CUST_ID)) = 'CA SENIOR' ) THEN 'WIS' WHEN ( LZ_ESI_CLM_MSTR.SUB_CARR_CD = 'WM2' AND UPPER(SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,10,3)) = 'IND' ) THEN 'PFI' WHEN ( LZ_ESI_CLM_MSTR.SUB_CARR_CD = 'WM2' AND UPPER(SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,10,3)) = 'EGR' ) THEN 'PFG' WHEN ( LZ_ESI_CLM_MSTR.SUB_CARR_CD = 'WM2' AND UPPER(SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,10,3)) = 'WGS' ) THEN 'GRW' WHEN ( LZ_ESI_CLM_MSTR.SUB_CARR_CD = 'WLB' AND UPPER(SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,1,4)) = 'CDHP' ) THEN 'CGA' WHEN ( LZ_ESI_CLM_MSTR.SUB_CARR_CD = 'WL7' AND UPPER(SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,1,4)) = 'CDHP' ) THEN 'CCT' WHEN ( LZ_ESI_CLM_MSTR.SUB_CARR_CD = 'WLA' AND UPPER(SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,1,4)) = 'CDHP' ) THEN 'CVA' WHEN ( LZ_ESI_CLM_MSTR.SUB_CARR_CD = 'WL5' AND UPPER(SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,1,4)) = 'CDHP' ) THEN 'COH' WHEN ( LZ_ESI_CLM_MSTR.SUB_CARR_CD = 'WL2' AND UPPER(SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,1,4)) = 'CDHP' ) THEN 'CIN' WHEN ( LZ_ESI_CLM_MSTR.SUB_CARR_CD = 'WL3' AND UPPER(SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,1,4)) = 'CDHP' ) THEN 'CKY' WHEN ( LZ_ESI_CLM_MSTR.SUB_CARR_CD = 'WLE' AND UPPER(SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,1,4)) = 'CDHP' ) THEN 'CCO' WHEN ( LZ_ESI_CLM_MSTR.SUB_CARR_CD = 'WL9' AND UPPER(SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,1,4)) = 'CDHP' ) THEN 'CNH' WHEN ( LZ_ESI_CLM_MSTR.SUB_CARR_CD = 'WLD' AND UPPER(SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,1,4)) = 'CDHP' ) THEN 'CEM' WHEN ( LZ_ESI_CLM_MSTR.SUB_CARR_CD = 'WL4' AND UPPER(SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,1,4)) = 'CDHP' ) THEN 'CMO' WHEN ( LZ_ESI_CLM_MSTR.SUB_CARR_CD = 'WL8' AND UPPER(SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,1,4)) = 'CDHP' ) THEN 'CME' ELSE NULL END AS "C CASE WHEN ( TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4)) = 'WGS' OR TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4)) = 'WGS' ) THEN SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,140,8) WHEN ( SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4) = 'QCAR' OR SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4) = 'QCAR' OR SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4) = 'STAR' OR SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4) = 'STAR' ) THEN SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,154,8) END AS "C TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,5,4)) AS "C CASE WHEN TRIM(LZ_ESI_CLM_MSTR.FRMLRY_CD) IN ('UNK' ,'NA', '') THEN NULL ELSE TRIM(LZ_ESI_CLM_MSTR.FRMLRY_CD) END AS "C CASE WHEN UPPER(TRIM(LZ_ESI_CLM_MSTR.PHRMCY_TYPE_CD)) IN ('R','D') THEN 'R' WHEN UPPER(TRIM(LZ_ESI_CLM_MSTR.PHRMCY_TYPE_CD)) = 'M' THEN 'M' ELSE NULL END AS "C CASE WHEN TRIM(LZ_ESI_CLM_MSTR.PHRMCY_NTWK_IND) IN ('UNK' ,'NA', '') THEN NULL ELSE TRIM(LZ_ESI_CLM_MSTR.PHRMCY_NTWK_IND) END AS "C LZ_ESI_CLM_MSTR.PAT_LAST_NM AS "C LZ_ESI_CLM_MSTR.PAT_FRST_NM AS "C SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,17,3) AS "C CASE WHEN UPPER(TRIM(LZ_ESI_CLM_MSTR.CLM_TYPE_CD)) = 'D' THEN CASE WHEN TRIM(LZ_ESI_CLM_MSTR.FED_DRUG_CLS_CD) IN ('UNK' ,'NA', '') THEN CASE WHEN TRIM(NBC_INFO.RX_OTC_CD) = '' THEN CASE WHEN TRIM(RX_INFO.RX_OTC_CD) = '' THEN NULL ELSE CASE WHEN UPPER(TRIM(RX_INFO.RX_OTC_CD)) = 'O' THEN 'O' WHEN UPPER(TRIM(RX_INFO.RX_OTC_CD)) = 'P' THEN 'O' WHEN UPPER(TRIM(RX_INFO.RX_OTC_CD)) = 'R' THEN 'F' WHEN UPPER(TRIM(RX_INFO.RX_OTC_CD)) = 'S' THEN 'F' ELSE NULL END END ELSE NBC_INFO.RX_OTC_CD END ELSE CASE WHEN UPPER(TRIM(LZ_ESI_CLM_MSTR.FED_DRUG_CLS_CD)) = 'O' THEN 'O' WHEN UPPER(TRIM(LZ_ESI_CLM_MSTR.FED_DRUG_CLS_CD)) = 'P' THEN 'O' WHEN UPPER(TRIM(LZ_ESI_CLM_MSTR.FED_DRUG_CLS_CD)) = 'R' THEN 'F' WHEN UPPER(TRIM(LZ_ESI_CLM_MSTR.FED_DRUG_CLS_CD)) = 'S' THEN 'F' ELSE NULL END END ELSE CASE WHEN TRIM(LZ_ESI_CLM_MSTR.FED_DRUG_CLS_CD) IN ('UNK' ,'NA', '') THEN CASE WHEN TRIM(NBC_INFO.RX_OTC_CD) = '' THEN CASE WHEN TRIM(RX_INFO.RX_OTC_CD) = '' THEN NULL ELSE CASE WHEN UPPER(TRIM(RX_INFO.RX_OTC_CD)) = 'O' THEN 'O' WHEN UPPER(TRIM(RX_INFO.RX_OTC_CD)) = 'P' THEN 'O' WHEN UPPER(TRIM(RX_INFO.RX_OTC_CD)) = 'R' THEN 'F' WHEN UPPER(TRIM(RX_INFO.RX_OTC_CD)) = 'S' THEN 'F' ELSE NULL END END ELSE NBC_INFO.RX_OTC_CD END ELSE TRIM(LZ_ESI_CLM_MSTR.FED_DRUG_CLS_CD) END END AS "C '1' AS "C CASE WHEN LZ_ESI_CLM_MSTR.FILLED_DT = '8888 WHEN LZ_ESI_CLM_MSTR.FILLED_DT IS NULL THEN '9999 ELSE LZ_ESI_CLM_MSTR.FILLED_DT END AS "C CASE WHEN TRIM(LZ_ESI_CLM_MSTR.OTHR_CVRG_CD) IN ('UNK' ,'NA', '') THEN NULL ELSE TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.OTHR_CVRG_CD,2,1)) END AS "C CAST( CAST(LZ_ESI_CLM_MSTR.CMPND_CD AS DECIMAL (1,0)) AS CHAR(1)) AS "C CASE WHEN TRIM(LZ_ESI_CLM_MSTR.PHRMCY_NTWK_IND) IN ('UNK' ,'NA', '') THEN NULL ELSE TRIM(LZ_ESI_CLM_MSTR.PHRMCY_NTWK_IND) END AS "C LZ_ESI_CLM_MSTR.PAT_LAST_NM AS "C SUBSTRING(TRIM(LZ_ESI_CLM_MSTR.PAT_FRST_NM),1,10) AS "C SUBSTRING(TRIM(LZ_ESI_CLM_MSTR.PAT_MID_INIT),1,1) AS "C SUBSTRING(TRIM(PHRMCY_INFO.PHRMCY_NM),1,16) AS "C SUBSTRING(TRIM(PHRMCY_INFO.PHRMCY_NM),17,4) AS "C NULL AS "C SUBSTRING(TRIM(PHRMCY_INFO.PHRMCY_ADRS_TXT),1,19) AS "C SUBSTRING(TRIM(PHRMCY_INFO.PHRMCY_ADRS_TXT),20,1) AS "C PHRMCY_INFO.PHRMCY_LCTN_CITY_NM AS "C CASE WHEN TRIM(PHRMCY_INFO.PHRMCY_LCTN_ST_CD) IN ('UNK' ,'NA', '') THEN NULL ELSE TRIM(PHRMCY_INFO.PHRMCY_LCTN_ST_CD) END AS "C PHRMCY_INFO.ZIP_CD AS "C 8888888 AS "C CASE WHEN LZ_ESI_CLM_MSTR.MBR_EFCTV_DT = '8888 WHEN LZ_ESI_CLM_MSTR.MBR_EFCTV_DT IS NULL THEN '9999 ELSE LZ_ESI_CLM_MSTR.MBR_EFCTV_DT END AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C CASE WHEN ( TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4)) = 'WGS' OR TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4)) = 'WGS' ) OR ( SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4) = 'QCAR' OR SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4) = 'QCAR' ) THEN SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,30,15) WHEN ( SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4) = 'STAR' OR SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4) = 'STAR' ) THEN CASE WHEN SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,1,3) IN ('IND', 'SNR', 'STE') THEN SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,154,8) ELSE SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,30,15) END END AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C CASE WHEN LZ_ESI_CLM_MSTR.BRTH_DT = '8888 WHEN LZ_ESI_CLM_MSTR.BRTH_DT IS NULL THEN '9999 ELSE LZ_ESI_CLM_MSTR.BRTH_DT END AS "C LZ_ESI_CLM_MSTR.OTHR_PAYOR_AMT AS "C LZ_ESI_CLM_MSTR.DDCTBL_ACCUMD_AMT + LZ_ESI_CLM_MSTR.MBR_OOP_ACCUMD_AMT AS "C (LZ_ESI_CLM_MSTR.WLP_AMT_BILLD CASE WHEN LZ_ESI_CLM_MSTR.CLM_RCVD_DT = '8888 WHEN LZ_ESI_CLM_MSTR.CLM_RCVD_DT IS NULL THEN '9999 ELSE LZ_ESI_CLM_MSTR.CLM_RCVD_DT END AS "C CASE WHEN TRIM(LZ_ESI_CLM_MSTR.GNRC_CLSFCTN_NBR) IN ('94200', '00002', '00003') THEN '0' WHEN TRIM(NBC_INFO.GCN) IN ('94200', '00002', '00003') THEN '0' ELSE '1' END AS "C CASE WHEN SUBSTRING(TRIM(LZ_ESI_CLM_MSTR.LBL_NM),1,25) NOT IN ('UNK' ,'NA', '') THEN SUBSTRING(TRIM(LZ_ESI_CLM_MSTR.LBL_NM),1,25) ELSE CASE WHEN SUBSTRING(TRIM(NBC_INFO.LABEL_NM),1,25) NOT IN ('UNK' ,'NA', '') THEN SUBSTRING(TRIM(NBC_INFO.LABEL_NM),1,25) ELSE RX_INFO.LABEL_NM END END AS "C CASE WHEN TRIM(LZ_ESI_CLM_MSTR.THRPTC_CLS_CD) IN ('UNK' ,'NA', '') THEN CASE WHEN TRIM(SUBSTRING(NBC_INFO.THRPTC_AHFS_CLASS_CD,1,6)) IN ('UNK' ,'NA', '') THEN CASE WHEN TRIM(SUBSTRING(RX_INFO.THRPTC_AHFS_CLASS_CD,1,6)) IN ('UNK' ,'NA', '') THEN 0 ELSE CASE WHEN ( CHARINDEX(' ' , TRIM(SUBSTRING(RX_INFO.THRPTC_AHFS_CLASS_CD,1,6))) > 0) OR (UPPER(TRIM(SUBSTRING(RX_INFO.THRPTC_AHFS_CLASS_CD,1,6))) (CASESPECIFIC) <> LOWER(TRIM(SUBSTRING(RX_INFO.THRPTC_AHFS_CLASS_CD,1,6))) (CASESPECIFIC)) THEN 0 ELSE CAST (TRIM(SUBSTRING(RX_INFO.THRPTC_AHFS_CLASS_CD,1,6)) AS DECIMAL (6,0)) END END ELSE CASE WHEN ( CHARINDEX(' ' , TRIM(SUBSTRING(NBC_INFO.THRPTC_AHFS_CLASS_CD,1,6))) > 0) OR (UPPER(TRIM(SUBSTRING(NBC_INFO.THRPTC_AHFS_CLASS_CD,1,6))) (CASESPECIFIC) <> LOWER(TRIM(SUBSTRING(NBC_INFO.THRPTC_AHFS_CLASS_CD,1,6))) (CASESPECIFIC)) THEN 0 ELSE CAST (TRIM(SUBSTRING(NBC_INFO.THRPTC_AHFS_CLASS_CD,1,6)) AS DECIMAL (6,0)) END END ELSE CASE WHEN ( CHARINDEX(' ' , TRIM(LZ_ESI_CLM_MSTR.THRPTC_CLS_CD)) > 0) OR (UPPER(TRIM(LZ_ESI_CLM_MSTR.THRPTC_CLS_CD)) (CASESPECIFIC) <> LOWER(TRIM(LZ_ESI_CLM_MSTR.THRPTC_CLS_CD)) (CASESPECIFIC)) THEN 0 ELSE CAST (TRIM(LZ_ESI_CLM_MSTR.THRPTC_CLS_CD) AS DECIMAL (6,0)) END END AS "C NULL AS "C CASE WHEN PRCNG_INFO_AWP.PRICE_AMT IS NULL THEN 0 ELSE CASE WHEN PRCNG_INFO_AWP.PRICE_AMT <= 9999.9999 THEN PRCNG_INFO_AWP.PRICE_AMT ELSE CASE WHEN PRCNG_INFO_AWP.PRICE_AMT > 9999.9999 THEN 9999.9999 ELSE 0 END END END AS "C CASE WHEN LZ_ESI_CLM_MSTR.SEX_CD = 1 THEN 'M' WHEN LZ_ESI_CLM_MSTR.SEX_CD = 2 THEN 'F' ELSE ' ' END AS "C CASE WHEN TRIM(LZ_ESI_CLM_MSTR.PRE_AUTHRZN_RSN) IN ('UNK' ,'NA', '') THEN NULL ELSE TRIM(LZ_ESI_CLM_MSTR.PRE_AUTHRZN_RSN) END AS "C CASE WHEN TRIM(LZ_ESI_CLM_MSTR.PRE_AUTHRZN_RSN) IN ('UNK' ,'NA', '') THEN NULL ELSE TRIM(LZ_ESI_CLM_MSTR.PRE_AUTHRZN_RSN) END AS "C CASE WHEN TRIM(LZ_ESI_CLM_MSTR.PRE_AUTHRZN_RSN) IN ('UNK' ,'NA', '') THEN NULL ELSE TRIM(LZ_ESI_CLM_MSTR.PRE_AUTHRZN_RSN) END AS "C CASE WHEN TRIM(LZ_ESI_CLM_MSTR.PRE_AUTHRZN_RSN) IN ('UNK' ,'NA', '') THEN NULL ELSE TRIM(LZ_ESI_CLM_MSTR.PRE_AUTHRZN_RSN) END AS "C CASE WHEN TRIM(LZ_ESI_CLM_MSTR.PHRMCY_NTWK_IND) IN ('UNK' ,'NA', '') THEN NULL ELSE TRIM(LZ_ESI_CLM_MSTR.PHRMCY_NTWK_IND) END AS "C CASE WHEN TRIM(LZ_ESI_CLM_MSTR.PRE_AUTHRZN_RSN) IN ('UNK' ,'NA', '') THEN NULL ELSE TRIM(LZ_ESI_CLM_MSTR.PRE_AUTHRZN_RSN) END AS "C NULL AS "C CASE WHEN TRIM(PHRMCY_INFO.PHRMCY_CORP_ID) IN ('UNK' ,'NA', '') THEN NULL WHEN ( CHARINDEX(' ' , SUBSTRING(PHRMCY_INFO.PHRMCY_CORP_ID,1,5)) > 0) OR (UPPER(SUBSTRING(PHRMCY_INFO.PHRMCY_CORP_ID,1,5)) (CASESPECIFIC) <> LOWER(SUBSTRING(PHRMCY_INFO.PHRMCY_CORP_ID,1,5)) (CASESPECIFIC)) THEN 0 ELSE SUBSTRING(PHRMCY_INFO.PHRMCY_CORP_ID,1,5) END AS "C CASE WHEN TRIM(LZ_ESI_CLM_MSTR.CLM_RCRD_SRC) IN ('UNK' ,'NA', '') THEN NULL WHEN UPPER(TRIM(LZ_ESI_CLM_MSTR.CLM_RCRD_SRC)) = 'E' THEN '2' WHEN UPPER(TRIM(LZ_ESI_CLM_MSTR.CLM_RCRD_SRC)) = 'P' AND TRIM(LZ_ESI_CLM_MSTR.CLM_PRCS_TYPE_CD) <> '3' THEN '3' WHEN UPPER(TRIM(LZ_ESI_CLM_MSTR.CLM_RCRD_SRC)) = 'T' THEN '3' ELSE NULL END AS "C CAST ( CAST( CAST(LZ_ESI_CLM_MSTR.ADJDCTN_DT AS FORMAT 'YY') AS CHAR(2) ) + LEFT( CAST( ( LZ_ESI_CLM_MSTR.ADJDCTN_DT CAST( CAST( EXTRACT (YY, LZ_ESI_CLM_MSTR.ADJDCTN_DT) AS CHAR(4)) + ' 1 ) AS CHAR(3)) ,3,'0') AS DECIMAL(5,0)) AS "C CASE WHEN ( CHARINDEX(' ' , SUBSTRING(BATCH_NBR.BTCH_NBR,2,4)) > 0) OR (UPPER(SUBSTRING(BATCH_NBR.BTCH_NBR,2,4)) (CASESPECIFIC) <> LOWER(SUBSTRING(BATCH_NBR.BTCH_NBR,2,4)) (CASESPECIFIC)) THEN 0 ELSE CAST (SUBSTRING(BATCH_NBR.BTCH_NBR,2,4) AS DECIMAL (4,0)) END AS "C CASE WHEN TRIM(LZ_ESI_CLM_MSTR.CLM_RCRD_SRC) IN ('UNK' ,'NA', '') THEN NULL ELSE TRIM(LZ_ESI_CLM_MSTR.CLM_RCRD_SRC) END AS "C CASE WHEN UPPER(TRIM(LZ_ESI_CLM_MSTR.CLM_TYPE_CD)) = 'P' THEN '1' WHEN UPPER(TRIM(LZ_ESI_CLM_MSTR.CLM_TYPE_CD)) = 'R' THEN '4' WHEN UPPER(TRIM(LZ_ESI_CLM_MSTR.CLM_TYPE_CD)) = 'D' THEN '1' ELSE ' ' END AS "C NULL AS "C LZ_ESI_CLM_MSTR.HOME_PLAN_CD AS "C LZ_ESI_CLM_MSTR.PHRMCY_NBR AS "C CASE WHEN TRIM( UPPER (LZ_ESI_CLM_MSTR.CLM_TYPE_CD)) = 'R' THEN ( ELSE LZ_ESI_CLM_MSTR.CSTMRY_CHRG_AMT END AS "C CASE WHEN PRCNG_INFO_MAXGENERIC.PRICE_AMT IS NULL THEN CASE WHEN PRCNG_INFO_AWP.PRICE_AMT IS NULL THEN 0 ELSE CASE WHEN PRCNG_INFO_AWP.PRICE_AMT <= 9999.9999 THEN PRCNG_INFO_AWP.PRICE_AMT ELSE CASE WHEN PRCNG_INFO_AWP.PRICE_AMT > 9999.9999 THEN 9999.9999 ELSE 0 END END END ELSE CASE WHEN PRCNG_INFO_MAXGENERIC.PRICE_AMT <> 0 THEN PRCNG_INFO_MAXGENERIC.PRICE_AMT ELSE CASE WHEN PRCNG_INFO_AWP.PRICE_AMT IS NULL THEN 0 ELSE CASE WHEN PRCNG_INFO_AWP.PRICE_AMT <= 9999.9999 THEN PRCNG_INFO_AWP.PRICE_AMT ELSE CASE WHEN PRCNG_INFO_AWP.PRICE_AMT > 9999.9999 THEN 9999.9999 ELSE 0 END END END END END AS "C LZ_ESI_CLM_MSTR.HOME_PLAN_CD AS "C CASE WHEN TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.GNRC_CLSFCTN_NBR,1,5)) IN ('UNK' ,'NA', '') THEN CASE WHEN TRIM(NBC_INFO.GCN) IN ('UNK' ,'NA', '') THEN 0 ELSE CASE WHEN ( CHARINDEX(' ' , TRIM(NBC_INFO.GCN)) > 0) OR (UPPER(TRIM(NBC_INFO.GCN)) (CASESPECIFIC) <> LOWER(TRIM(NBC_INFO.GCN)) (CASESPECIFIC)) THEN 0 ELSE CAST(TRIM(NBC_INFO.GCN) AS DECIMAL (5,0)) END END ELSE CASE WHEN ( CHARINDEX(' ' , SUBSTRING(LZ_ESI_CLM_MSTR.GNRC_CLSFCTN_NBR,1,5)) > 0) OR (UPPER(SUBSTRING(LZ_ESI_CLM_MSTR.GNRC_CLSFCTN_NBR,1,5)) (CASESPECIFIC) <> LOWER(SUBSTRING(LZ_ESI_CLM_MSTR.GNRC_CLSFCTN_NBR,1,5)) (CASESPECIFIC)) THEN 0 ELSE CAST(SUBSTRING(LZ_ESI_CLM_MSTR.GNRC_CLSFCTN_NBR,1,5) AS DECIMAL (5,0)) END END AS "C CASE WHEN TRIM(LZ_ESI_CLM_MSTR.DRUG_TYPE_CD) = '1' THEN 2 WHEN TRIM(LZ_ESI_CLM_MSTR.DRUG_TYPE_CD) = '2' THEN 2 WHEN TRIM(LZ_ESI_CLM_MSTR.DRUG_TYPE_CD) = '3' THEN 1 WHEN TRIM(LZ_ESI_CLM_MSTR.DRUG_TYPE_CD) = '4' THEN 0 WHEN TRIM(LZ_ESI_CLM_MSTR.DRUG_TYPE_CD) = '5' THEN 3 ELSE 0 END AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NBC_INFO.SMARTKEY_ID AS "C CASE WHEN TRIM(LZ_ESI_CLM_MSTR.PHRMCY_TYPE_CD) IN ('UNK' ,'NA', '') THEN NULL ELSE TRIM(LZ_ESI_CLM_MSTR.PHRMCY_TYPE_CD) END AS "C CAST (CAST (LZ_ESI_CLM_MSTR.RLTNSHP_CD AS DECIMAL (1,0)) AS CHAR(1)) AS "C CASE WHEN ( TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4)) = 'WGS' OR TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4)) = 'WGS' ) THEN SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,1,15) WHEN ( SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4) = 'QCAR' OR SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4) = 'QCAR' ) THEN SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,163,7) WHEN ( SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4) = 'STAR' OR SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4) = 'STAR' ) THEN CASE WHEN SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,1,3) IN ('IND', 'SNR', 'STE') THEN TRIM ( TRAILING FROM ( SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,1,6) + '0000' ) ) ELSE TRIM ( TRAILING FROM ( SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,30,6) + '0000' ) ) END END AS "C CASE WHEN ( TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4)) = 'WGS' OR TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4)) = 'WGS' ) THEN '0' + TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,59,14)) WHEN ( SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4) = 'QCAR' OR SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4) = 'QCAR' ) THEN CASE WHEN SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,1,2) IN ('32', '33', '34', '35') THEN ( SUBSTRING(LZ_ESI_CLM_MSTR.CLNT_CUST_ID,1,2) + SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,1,3) ) ELSE NULL END WHEN ( SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4) = 'STAR' OR SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4) = 'STAR' ) THEN TRIM ( TRAILING FROM ('0' + SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,45,15))) END AS "C CASE WHEN ( TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4)) = 'WGS' OR TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4)) = 'WGS' OR SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4) = 'QCAR' OR SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4) = 'QCAR' ) THEN SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,30,10) WHEN ( SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4) = 'STAR' OR SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4) = 'STAR' ) THEN SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,1,10) END AS "C SUB_CARR_CD AS "C CLNT_CUST_ID AS "C SUBSTRING(LZ_ESI_CLM_MSTR.ESI_CLNT_GNRL_PUR_AREA_CD,1,20) AS "C CASE WHEN ( TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4)) = 'WGS' OR TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4)) = 'WGS' ) THEN SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,140,8) WHEN ( SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4) = 'QCAR' OR SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4) = 'QCAR' OR SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4) = 'STAR' OR SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4) = 'STAR' ) THEN SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,154,8) END AS "C CASE WHEN ( TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4)) = 'WGS' OR TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4)) = 'WGS' ) THEN SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,148,4) WHEN ( SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4) = 'QCAR' OR SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4) = 'QCAR' ) THEN NULL WHEN ( SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4) = 'STAR' OR SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4) = 'STAR' ) THEN SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,136,4) END AS "C NULL AS "C NULL AS "C NULL AS "C LZ_ESI_CLM_MSTR.OTHR_TROOP_AMT AS "C NULL AS "C LZ_ESI_CLM_MSTR.LICS_SBSDY_AMT AS "C NULL AS "C NULL AS "C LZ_ESI_CLM_MSTR.CMS_CNTRCT_CD AS "C LZ_ESI_CLM_MSTR.HIC_NBR AS "C LZ_ESI_CLM_MSTR.PBP_ID AS "C CASE WHEN TRIM(LZ_ESI_CLM_MSTR.CTSTRPHC_CVRG_CD) IN ('UNK' ,'NA', '') THEN NULL ELSE TRIM(LZ_ESI_CLM_MSTR.CTSTRPHC_CVRG_CD) END AS "C LZ_ESI_CLM_MSTR.ADJSTD_OOP_AMT AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C LZ_ESI_CLM_MSTR.CPAY_AMT AS "C LZ_ESI_CLM_MSTR.GROS_DRUG_COST_ABV_OOP_AMT AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C RX_INFO.RX_CTGRY_CD AS "C NULL AS "C LZ_ESI_CLM_MSTR.CSTMRY_CHRG_AMT AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C SUBSTRING(TRIM(WLP_MBR_CD),1,3) AS "C NULL AS "C LZ_ESI_CLM_MSTR.PAT_LAST_NM AS "C SUBSTRING(TRIM(LZ_ESI_CLM_MSTR.PAT_FRST_NM),1,5) AS "C CASE WHEN TRIM(LZ_ESI_CLM_MSTR.INGRED_NM) IN ('UNK' ,'NA', '') THEN CASE WHEN TRIM(NBC_INFO.GNRC_INGRDNT_NM) IN ('UNK' ,'NA', '') THEN CASE WHEN TRIM(RX_INFO.GNRC_INGRDNT_NM) IN ('UNK' ,'NA', '') THEN NULL ELSE SUBSTRING(RX_INFO.GNRC_INGRDNT_NM,1,30) END ELSE SUBSTRING(NBC_INFO.GNRC_INGRDNT_NM,1,30) END ELSE LZ_ESI_CLM_MSTR.INGRED_NM END AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NBC_INFO.FORM_TYPE_CD AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C PHRMCY_INFO.PHRMCY_NM AS "C NULL AS "C NULL AS "C NULL AS "C PHRMCY_INFO.ZIP_CD AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C LZ_ESI_CLM_MSTR.WLP_ADMIN_FEE AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C LZ_ESI_CLM_MSTR.PRSCRBR_LAST_NM AS "C LZ_ESI_CLM_MSTR.PRSCRBR_NM_FRST AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C CASE WHEN TRIM(LZ_ESI_CLM_MSTR.BILLD_BSIS_CD) IN ('UNK' ,'NA', '') THEN NULL WHEN TRIM(LZ_ESI_CLM_MSTR.BILLD_BSIS_CD) = '00' THEN 'O' WHEN TRIM(LZ_ESI_CLM_MSTR.BILLD_BSIS_CD) = '01' THEN '1' WHEN TRIM(LZ_ESI_CLM_MSTR.BILLD_BSIS_CD) = '06' THEN '6' WHEN TRIM(LZ_ESI_CLM_MSTR.BILLD_BSIS_CD) = '07' THEN '7' WHEN TRIM(LZ_ESI_CLM_MSTR.BILLD_BSIS_CD) = '08' THEN '8' WHEN TRIM(LZ_ESI_CLM_MSTR.BILLD_BSIS_CD) = '09' THEN '9' WHEN TRIM(LZ_ESI_CLM_MSTR.BILLD_BSIS_CD) = '10' THEN ' ' WHEN TRIM(LZ_ESI_CLM_MSTR.BILLD_BSIS_CD) = '12' THEN 'A' WHEN TRIM(LZ_ESI_CLM_MSTR.BILLD_BSIS_CD) = '13' THEN ' ' WHEN TRIM(LZ_ESI_CLM_MSTR.BILLD_BSIS_CD) = '14' THEN 'Z' WHEN TRIM(LZ_ESI_CLM_MSTR.BILLD_BSIS_CD) = '15' THEN ' ' ELSE NULL END AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C NULL AS "C LZ_ESI_CLM_MSTR.MBR_AMT_APLYD_TO_OOP AS "C CASE WHEN TRIM(LZ_ESI_CLM_MSTR.ADJST_RJCT_CD) IN ('UNK' ,'NA', '') THEN NULL ELSE TRIM(LZ_ESI_CLM_MSTR.ADJST_RJCT_CD) END AS "C CASE WHEN TRIM(LZ_ESI_CLM_MSTR.ADJST_RJCT_CD_2) IN ('UNK' ,'NA', '') THEN NULL ELSE TRIM(LZ_ESI_CLM_MSTR.ADJST_RJCT_CD_2) END AS "C CASE WHEN TRIM(LZ_ESI_CLM_MSTR.ADJST_RJCT_CD_3) IN ('UNK' ,'NA', '') THEN NULL ELSE TRIM(LZ_ESI_CLM_MSTR.ADJST_RJCT_CD_3) END AS "C CASE WHEN UPPER(TRIM(LZ_ESI_CLM_MSTR.FRMLRY_CD)) = 'F' THEN '1' WHEN UPPER(TRIM(LZ_ESI_CLM_MSTR.FRMLRY_CD)) = 'N' THEN '0' ELSE NULL END AS "C CASE WHEN TRIM(LZ_ESI_CLM_MSTR.DRUG_STRNGTH_CD) IN ('UNK' ,'NA', '') THEN CASE WHEN TRIM(NBC_INFO.STRNGTH_DESC) IN ('UNK' ,'NA', '') THEN CAST(CAST(RX_INFO.METRIC_STRNGTH_NBR AS DECIMAL(14,5)) AS CHAR(10)) ELSE SUBSTRING(NBC_INFO.STRNGTH_DESC,1,10) END ELSE LZ_ESI_CLM_MSTR.DRUG_STRNGTH_CD END AS "C RX_INFO.RX_CTGRY_CD AS "C NULL AS "C CASE WHEN ( TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4)) = 'WGS' OR TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4)) = 'WGS' ) THEN SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,140,8) WHEN ( SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4) = 'QCAR' OR SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4) = 'QCAR' OR SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4) = 'STAR' OR SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4) = 'STAR' ) THEN SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,154,8) END AS "C CASE WHEN TRIM(LZ_ESI_CLM_MSTR.CVRG_STTS_CD) IN ('UNK' ,'NA', '') THEN NULL ELSE SUBSTRING(TRIM(LZ_ESI_CLM_MSTR.CVRG_STTS_CD),2,1) END AS "C NULL AS "C CAST( SUBSTRING( CAST( CAST( LZ_ESI_CLM_MSTR.BRTH_DT AS DATE FORMAT 'YYYY') AS CHAR(4) ) , 1, 2) AS DECIMAL(2)) AS "C LZ_ESI_CLM_MSTR.ESI_ANCLRY_AMT AS "C CASE WHEN NBC_INFO.GNRC_IND_CD = '1' THEN '1' WHEN NBC_INFO.GNRC_IND_CD = '2' THEN '2' WHEN NBC_INFO.GNRC_IND_CD = 'U' THEN ' ' WHEN RX_INFO.GNRC_MULTI_SRC_CD = '1' THEN '1' WHEN RX_INFO.GNRC_MULTI_SRC_CD = '2' THEN '2' WHEN RX_INFO.GNRC_MULTI_SRC_CD = 'U' THEN ' ' ELSE NULL END AS "C LZ_ESI_CLM_MSTR.CPAY_AMT AS "C CASE WHEN TRIM( UPPER (LZ_ESI_CLM_MSTR.CLM_TYPE_CD)) = 'R' THEN ( ELSE LZ_ESI_CLM_MSTR.CVRD_PLAN_PAYMNT_AMT END AS "C CASE WHEN TRIM( UPPER (LZ_ESI_CLM_MSTR.CLM_TYPE_CD)) = 'R' THEN ( ELSE LZ_ESI_CLM_MSTR.NON_CVRD_PLAN_PAYMNT_AMT END AS "C NULL AS "C NULL AS "C NULL AS "C LZ_ESI_CLM_MSTR.HRA_APLYD_AMT AS "C LZ_ESI_CLM_MSTR.WLP_AMT_BILLD CASE WHEN ( TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,26,4)) = 'WGS' OR TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,33,4)) = 'WGS' ) THEN TRIM(SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP,136,2)) ELSE NULL END AS "C LZ_ESI_CLM_MSTR.PHRMCY_NPI_ID AS "C CASE WHEN TRIM(LZ_ESI_CLM_MSTR.NPI_PRSCRBR_ID) IN ('UNK' ,'NA', '') THEN NULL ELSE TRIM(LZ_ESI_CLM_MSTR.NPI_PRSCRBR_ID) END AS "C SUBSTRING(LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR,57,2) AS "C CASE WHEN TRIM( UPPER (LZ_ESI_CLM_MSTR.CLM_TYPE_CD)) = 'R' THEN ( ELSE LZ_ESI_CLM_MSTR.CDHP_DDCTBL_AMT_PRIOR_TO_HRA END AS "C NULL AS "C LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_MBR AS "C LZ_ESI_CLM_MSTR.MISC_CLNT_SPCFC_GRP AS "C LZ_ESI_CLM_MSTR.LOAD_LOG_KEY AS "3", LZ_ESI_CLM_MSTR.GL_BUSINESS_UNIT AS "C LZ_ESI_CLM_MSTR.GL_MBU AS "C LZ_ESI_CLM_MSTR.GL_FUNDING_CODE_THC AS "C LZ_ESI_CLM_MSTR.GL_FUNDING_CODE_CDH AS "C LZ_ESI_CLM_MSTR.GL_PRODUCT AS "C LZ_ESI_CLM_MSTR.GL_LOCATION AS "C LZ_ESI_CLM_MSTR.GL_DETAIL_PRODUCT AS "C LZ_ESI_CLM_MSTR.GL_AMT AS "C LZ_ESI_CLM_MSTR.GL_HRA_AMT AS "C LZ_ESI_CLM_MSTR.GL_STATSTCL_AMT AS "C LZ_ESI_CLM_MSTR.GL_ACCNT_NBR AS "C LZ_ESI_CLM_MSTR.PSGL_AFFILIATE AS "C CASE WHEN LZ_ESI_CLM_MSTR.JRNL_DT = '8888 WHEN LZ_ESI_CLM_MSTR.JRNL_DT IS NULL THEN '9999 ELSE LZ_ESI_CLM_MSTR.JRNL_DT END AS "C LZ_ESI_CLM_MSTR.SUB_CARR_CD AS "C LZ_ESI_CLM_MSTR.CLNT_CUST_ID AS "C LZ_ESI_CLM_MSTR.GL_ACCNT_NBR_CDH AS "C LZ_ESI_CLM_MSTR.DLY_WKLY AS "C CASE WHEN TRIM( UPPER (LZ_ESI_CLM_MSTR.CLM_TYPE_CD)) = 'R' THEN (LZ_ESI_CLM_MSTR.MBR_AMT_COINSRN ELSE (LZ_ESI_CLM_MSTR.MBR_AMT_COINSRN END AS "C LZ_ESI_CLM_MSTR.VAP_CD AS "C LZ_ESI_CLM_MSTR.GL_ACCNT_NBR_ADM AS "C LZ_ESI_CLM_MSTR.EXTNDD_RX_NBR AS "C CASE WHEN TRIM(LZ_ESI_CLM_MSTR.PRTL_FILL_STTS_CD) IN ('UNK' ,'NA', '') THEN NULL ELSE TRIM(LZ_ESI_CLM_MSTR.PRTL_FILL_STTS_CD) END AS "C CASE WHEN NBC_INFO.PKG_SIZE_NBR IS NULL OR NBC_INFO.PKG_SIZE_NBR = 0 THEN RX_INFO.PKG_SIZE_NBR ELSE NBC_INFO.PKG_SIZE_NBR END AS "C LZ_ESI_CLM_MSTR.INGRED_COST_MRGN AS "C LZ_ESI_CLM_MSTR.DSPNSG_FEE_MRGN AS "C LZ_ESI_CLM_MSTR.ADMIN_FEE_MRGN AS "C LZ_ESI_CLM_MSTR.AMT_BILLD_MRGN AS "C LZ_ESI_CLM_MSTR.WLP_PHYS_IO_NTW_IND AS "CFROM $DB_ETL_VIEWS_ESI.${TBL_NM} AS LZ_ESI_CLM_MSTRLEFT OUTER JOIN ( SELECT DISTINCT AAA.NDC AS NDC, AAA.LABEL_NM AS LABEL_NM, AAA.GNRC_IND_CD AS GNRC_IND_CD, AAA.THRPTC_SPCFC_CLASS_CD, AAA.THRPTC_AHFS_CLASS_CD, AAA.PKG_UOM_CD, AAA.SMARTKEY_ID, AAA.GCN, AAA.GNRC_INGRDNT_NM, AAA.PKG_SIZE_NBR, AAA.RX_OTC_CD, BBB.STRNGTH_DESC, AAA.FORM_TYPE_CD FROM ( SELECT BB.NDC AS NDC, BB.LABEL_NM AS LABEL_NM, BB.MNFCTRR_NM AS MNFCTRR_NM, BB.PKG_SIZE_NBR AS PKG_SIZE_NBR, BB.SMARTKEY_ID AS SMARTKEY_ID, BB.GNRC_IND_CD AS GNRC_IND_CD, BB.MNTNC_DRUG_IND AS MNTNC_DRUG_IND, BB.THRPTC_AHFS_CLASS_CD AS THRPTC_AHFS_CLASS_CD, BB.DESI_IND AS DESI_IND, BB.RX_CTGRY_CD AS RX_CTGRY_CD, BB.RX_OTC_CD AS RX_OTC_CD, BB.THRPTC_SPCFC_CLASS_CD AS THRPTC_SPCFC_CLASS_CD, BB.PKG_UOM_CD AS PKG_UOM_CD, BB.GCN AS GCN, BB.GNRC_INGRDNT_NM AS GNRC_INGRDNT_NM, BB.FORM_TYPE_CD AS FORM_TYPE_CD FROM $DB_EDLRX.LOAD_LOG AS AA INNER JOIN $DB_EDLRX.FDB_NDC AS BB ON AA.LOAD_LOG_KEY = BB.LOAD_LOG_KEY AND AA.PUBLISH_IND = 'Y' INNER JOIN ( SELECT A.NDC, MAX(B.LOAD_END_TMS) AS LOAD_END_TMS FROM $DB_EDLRX.FDB_NDC AS A INNER JOIN $DB_EDLRX.LOAD_LOG AS B ON A.LOAD_LOG_KEY = B.LOAD_LOG_KEY AND B.PUBLISH_IND = 'Y' GROUP BY (A.NDC) ) CC ON AA.LOAD_END_TMS = CC.LOAD_END_TMS AND BB.NDC = CC.NDC ) AS AAA LEFT OUTER JOIN ( SELECT EE.STRNGTH_DESC AS STRNGTH_DESC, EE.SMARTKEY_ID FROM $DB_EDLRX.LOAD_LOG AS DD INNER JOIN $DB_EDLRX.FDB_SMARTKEY AS EE ON EE.LOAD_LOG_KEY = DD.LOAD_LOG_KEY AND DD.PUBLISH_IND = 'Y' INNER JOIN ( SELECT D.SMARTKEY_ID, MAX(E.LOAD_END_TMS) AS LOAD_END_TMS FROM $DB_EDLRX.FDB_SMARTKEY AS D INNER JOIN $DB_EDLRX.LOAD_LOG AS E ON D.LOAD_LOG_KEY = E.LOAD_LOG_KEY AND E.PUBLISH_IND = 'Y' GROUP BY (D.SMARTKEY_ID) ) FF ON DD.LOAD_END_TMS = FF.LOAD_END_TMS AND EE.SMARTKEY_ID = FF.SMARTKEY_ID ) AS BBB ON AAA.SMARTKEY_ID = BBB.SMARTKEY_ID ROW_NUMBER() OVER (PARTITION BY AAA.NDC ORDER BY AAA.NDC ) = 1 ) AS NBC_INFO ON NBC_INFO.NDC = LZ_ESI_CLM_MSTR.NDC_NBRLEFT OUTER JOIN ( SELECT DISTINCT BB.NDC AS NDC, BB.RX_CTGRY_CD AS RX_CTGRY_CD, BB.THRPTC_AHFS_CLASS_CD AS THRPTC_AHFS_CLASS_CD, BB.LABEL_NM AS LABEL_NM, BB.PKG_UOM_CD AS PKG_UOM_CD, BB.GPI AS GPI, BB.GNRC_INGRDNT_NM AS GNRC_INGRDNT_NM, BB.PKG_SIZE_NBR AS PKG_SIZE_NBR, BB.METRIC_STRNGTH_NBR AS METRIC_STRNGTH_NBR, BB.GNRC_MULTI_SRC_CD AS GNRC_MULTI_SRC_CD, BB.RX_OTC_CD AS RX_OTC_CD FROM $DB_EDLRX.LOAD_LOG AA INNER JOIN $DB_EDLRX.RX_MSTR BB ON AA.LOAD_LOG_KEY = BB.LOAD_LOG_KEY AND AA.PUBLISH_IND = 'Y' INNER JOIN ( SELECT A.NDC, MAX(B.LOAD_END_TMS) AS LOAD_END_TMS FROM $DB_EDLRX.RX_MSTR A INNER JOIN $DB_EDLRX.LOAD_LOG B ON A.LOAD_LOG_KEY = B.LOAD_LOG_KEY AND B.PUBLISH_IND = 'Y' GROUP BY (A.NDC) ) CC ON AA.LOAD_END_TMS = CC.LOAD_END_TMS AND BB.NDC = CC.NDC ROW_NUMBER() OVER (PARTITION BY BB.NDC ORDER BY BB.NDC ) = 1 ) AS RX_INFO ON RX_INFO.NDC = LZ_ESI_CLM_MSTR.NDC_NBRLEFT OUTER JOIN ( SELECT DISTINCT BB.PHRMCY_NBR AS PHRMCY_NBR, BB.PHRMCY_NM AS PHRMCY_NM, BB.PHRMCY_ADRS_TXT AS PHRMCY_ADRS_TXT, BB.PHRMCY_CORP_ID AS PHRMCY_CORP_ID, BB.PHRMCY_ZIP_CD AS ZIP_CD, BB.PHRMCY_LCTN_ST_CD AS PHRMCY_LCTN_ST_CD, BB.PHRMCY_LCTN_CITY_NM AS PHRMCY_LCTN_CITY_NM FROM $DB_ETL_VIEWS_ESI.$TGT_LOAD_LOG AA INNER JOIN $DB_ETL_VIEWS_ESI.${PHRMCY_TBL_NM} BB ON AA.LOAD_LOG_KEY = BB.LOAD_LOG_KEY AND AA.PBLSH_IND = 'Y' INNER JOIN ( SELECT A.PHRMCY_NBR, MAX(B.LOAD_END_DTM) AS LOAD_END_DTM FROM $DB_ETL_VIEWS_ESI.${PHRMCY_TBL_NM} A INNER JOIN $DB_ETL_VIEWS_ESI.$TGT_LOAD_LOG B ON A.LOAD_LOG_KEY = B.LOAD_LOG_KEY AND B.PBLSH_IND = 'Y' GROUP BY A.PHRMCY_NBR )CC ON AA.LOAD_END_DTM = CC.LOAD_END_DTM AND BB.PHRMCY_NBR = CC.PHRMCY_NBR ROW_NUMBER() OVER (PARTITION BY BB.PHRMCY_NBR ORDER BY BB.PHRMCY_NBR ) = 1 ) AS PHRMCY_INFO ON PHRMCY_INFO.PHRMCY_NBR = LZ_ESI_CLM_MSTR.PHRMCY_NBRLEFT OUTER JOIN ( SELECT DISTINCT PRICING_TABLE.NDC, PRICE_AMT FROM $DB_EDLRX.$PRICING_TABLE AS PRICING_TABLE INNER JOIN ( SELECT MAX_PUBLISH_DT.NDC AS NDC, MAX_PUBLISH_DT.PRICE_TYPE_CD AS PRICE_TYPE_CD, MAX_PUBLISH_DT.UNIT_PKG_IND AS UNIT_PKG_IND, MAX_PUBLISH_DT.PRICE_SRC_CD AS PRICE_SRC_CD, MAX_PUBLISH_DT.MAX_PUBLISH_DT AS MAX_PUBLISH_DT, MAX(EFCTV_DT) AS MAX_EFCTV_DT FROM $DB_EDLRX.$PRICING_TABLE AS RX_PRCG INNER JOIN ( SELECT NDC, PRICE_TYPE_CD, UNIT_PKG_IND, PRICE_SRC_CD, MAX(PUBLISH_DT) AS MAX_PUBLISH_DT FROM $DB_EDLRX.$PRICING_TABLE GROUP BY NDC, PRICE_TYPE_CD, UNIT_PKG_IND, PRICE_SRC_CD ) AS MAX_PUBLISH_DT ON MAX_PUBLISH_DT.NDC = RX_PRCG.NDC AND MAX_PUBLISH_DT.MAX_PUBLISH_DT = RX_PRCG.PUBLISH_DT AND MAX_PUBLISH_DT.PRICE_TYPE_CD = RX_PRCG.PRICE_TYPE_CD AND MAX_PUBLISH_DT.UNIT_PKG_IND = RX_PRCG.UNIT_PKG_IND AND MAX_PUBLISH_DT.PRICE_SRC_CD = RX_PRCG.PRICE_SRC_CD GROUP BY MAX_PUBLISH_DT.NDC, MAX_PUBLISH_DT.PRICE_TYPE_CD, MAX_PUBLISH_DT.UNIT_PKG_IND, MAX_PUBLISH_DT.PRICE_SRC_CD, MAX_PUBLISH_DT.MAX_PUBLISH_DT ) AS MAX_DATES ON PRICING_TABLE.NDC = MAX_DATES.NDC AND PRICING_TABLE.PUBLISH_DT = MAX_DATES.MAX_PUBLISH_DT AND PRICING_TABLE.EFCTV_DT = MAX_DATES.MAX_EFCTV_DT AND PRICING_TABLE.PRICE_TYPE_CD = MAX_DATES.PRICE_TYPE_CD AND PRICING_TABLE.UNIT_PKG_IND = MAX_DATES.UNIT_PKG_IND AND PRICING_TABLE.PRICE_SRC_CD = MAX_DATES.PRICE_SRC_CD WHERE PRICING_TABLE.PRICE_TYPE_CD = 'AWP' AND PRICING_TABLE.UNIT_PKG_IND = 'U' AND PRICING_TABLE.PRICE_SRC_CD = 'FDB' ROW_NUMBER() OVER (PARTITION BY PRICING_TABLE.NDC ORDER BY PRICING_TABLE.NDC ) = 1 ) AS PRCNG_INFO_AWP ON PRCNG_INFO_AWP.NDC = LZ_ESI_CLM_MSTR.NDC_NBRLEFT OUTER JOIN ( SELECT DISTINCT PRICING_TABLE.NDC, PRICE_AMT FROM $DB_EDLRX.$PRICING_TABLE AS PRICING_TABLE INNER JOIN ( SELECT MAX_PUBLISH_DT.NDC AS NDC, MAX_PUBLISH_DT.PRICE_TYPE_CD AS PRICE_TYPE_CD, MAX_PUBLISH_DT.UNIT_PKG_IND AS UNIT_PKG_IND, MAX_PUBLISH_DT.PRICE_SRC_CD AS PRICE_SRC_CD, MAX_PUBLISH_DT.MAX_PUBLISH_DT AS MAX_PUBLISH_DT, MAX(EFCTV_DT) AS MAX_EFCTV_DT FROM $DB_EDLRX.$PRICING_TABLE AS RX_PRCG INNER JOIN ( SELECT NDC, PRICE_TYPE_CD, UNIT_PKG_IND, PRICE_SRC_CD, MAX(PUBLISH_DT) AS MAX_PUBLISH_DT FROM $DB_EDLRX.$PRICING_TABLE GROUP BY NDC, PRICE_TYPE_CD, UNIT_PKG_IND, PRICE_SRC_CD ) AS MAX_PUBLISH_DT ON MAX_PUBLISH_DT.NDC = RX_PRCG.NDC AND MAX_PUBLISH_DT.MAX_PUBLISH_DT = RX_PRCG.PUBLISH_DT AND MAX_PUBLISH_DT.PRICE_TYPE_CD = RX_PRCG.PRICE_TYPE_CD AND MAX_PUBLISH_DT.UNIT_PKG_IND = RX_PRCG.UNIT_PKG_IND AND MAX_PUBLISH_DT.PRICE_SRC_CD = RX_PRCG.PRICE_SRC_CD GROUP BY MAX_PUBLISH_DT.NDC, MAX_PUBLISH_DT.PRICE_TYPE_CD, MAX_PUBLISH_DT.UNIT_PKG_IND, MAX_PUBLISH_DT.PRICE_SRC_CD, MAX_PUBLISH_DT.MAX_PUBLISH_DT ) AS MAX_DATES ON PRICING_TABLE.NDC = MAX_DATES.NDC AND PRICING_TABLE.PUBLISH_DT = MAX_DATES.MAX_PUBLISH_DT AND PRICING_TABLE.EFCTV_DT = MAX_DATES.MAX_EFCTV_DT AND PRICING_TABLE.PRICE_TYPE_CD = MAX_DATES.PRICE_TYPE_CD AND PRICING_TABLE.UNIT_PKG_IND = MAX_DATES.UNIT_PKG_IND AND PRICING_TABLE.PRICE_SRC_CD = MAX_DATES.PRICE_SRC_CD WHERE PRICING_TABLE.PRICE_TYPE_CD = 'MAXGENERIC' AND PRICING_TABLE.UNIT_PKG_IND = 'U' AND PRICING_TABLE.PRICE_SRC_CD = 'FDB' ROW_NUMBER() OVER (PARTITION BY PRICING_TABLE.NDC ORDER BY PRICING_TABLE.NDC ) = 1 ) AS PRCNG_INFO_MAXGENERIC ON PRCNG_INFO_MAXGENERIC.NDC = LZ_ESI_CLM_MSTR.NDC_NBRCROSS JOIN ( SELECT MAX(FINAL_QRY.BATCH_NBR) AS BTCH_NBR FROM ( SELECT CASE WHEN COUNT_QRY.ROW_COUNT = 0 THEN CAST(' ' AS CHAR(5)) END AS BATCH_NBR FROM ( SELECT COUNT(*) AS ROW_COUNT FROM ( SELECT BTCH_NBR AS BATCH_NBR FROM $DB_ETL_VIEWS_ESI.${TBL_NM} AS LZ_ESI_CLM_MSTR WHERE DLY_WKLY = 'W' AND LOAD_LOG_KEY IN (SELECT ESI_LOAD_LOG_KEY FROM $DB_ETL_VIEWS_ESI.$TGT_LOAD_LOG_LKUP WHERE XTRCT_LOAD_LOG_KEY IN ( SELECT LOAD_LOG_KEY FROM $DB_ETL_VIEWS_ESI.$TGT_LOAD_LOG WHERE WORK_FLOW_NM ='$WORK_FLOW_NM' AND LOAD_END_DTM = ( SELECT MAX(LOAD_END_DTM) FROM $DB_ETL_VIEWS_ESI.$TGT_LOAD_LOG WHERE WORK_FLOW_NM='$WORK_FLOW_NM' AND PBLSH_IND='N' ) AND PBLSH_IND='N' ) ) ) AS INNER_QRY ) COUNT_QRY UNION SELECT BATCH_QRY.BATCH_NBR FROM ( SELECT TOP 1 BTCH_NBR AS BATCH_NBR FROM $DB_ETL_VIEWS_ESI.${TBL_NM} AS LZ_ESI_CLM_MSTR WHERE DLY_WKLY = 'W' AND LOAD_LOG_KEY IN ( SELECT ESI_LOAD_LOG_KEY FROM $DB_ETL_VIEWS_ESI.$TGT_LOAD_LOG_LKUP WHERE XTRCT_LOAD_LOG_KEY IN ( SELECT LOAD_LOG_KEY FROM $DB_ETL_VIEWS_ESI.$TGT_LOAD_LOG WHERE WORK_FLOW_NM ='$WORK_FLOW_NM' AND LOAD_END_DTM = ( SELECT MAX(LOAD_END_DTM) FROM $DB_ETL_VIEWS_ESI.$TGT_LOAD_LOG WHERE WORK_FLOW_NM='$WORK_FLOW_NM' AND PBLSH_IND='N' ) AND PBLSH_IND='N' ) ) ) AS BATCH_QRY ) AS FINAL_QRY ) AS BATCH_NBRWHERE LZ_ESI_CLM_MSTR.LOAD_LOG_KEY IN (SELECT ESI_LOAD_LOG_KEY FROM $DB_ETL_VIEWS_ESI.$TGT_LOAD_LOG_LKUP WHERE XTRCT_LOAD_LOG_KEY IN ( SELECT LOAD_LOG_KEY FROM $DB_ETL_VIEWS_ESI.$TGT_LOAD_LOG WHERE WORK_FLOW_NM ='$WORK_FLOW_NM' AND LOAD_END_DTM = ( SELECT MAX(LOAD_END_DTM) FROM $DB_ETL_VIEWS_ESI.$TGT_LOAD_LOG WHERE WORK_FLOW_NM='$WORK_FLOW_NM' AND PBLSH_IND='N' ) AND PBLSH_IND='N') ) AND "1" IN ('WGS', 'STAR', 'QCAR')"
cursor = connection.cursor()
cursor.execute(query8)
connection.commit()

